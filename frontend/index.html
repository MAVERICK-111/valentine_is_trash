<!DOCTYPE html>
<html>
<head>
  <title>Campus Digital Twin – Bin Registry</title>

  <style>
    body { font-family: Arial; text-align: center; }

    .map {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 30px;
    }

    .square {
      width: 200px;
      height: 200px;
      border: 2px solid black;
      position: relative;
    }

    .corner {
      width: 16px;
      height: 16px;
      background: red;
      border-radius: 50%;
      position: absolute;
      cursor: pointer;
    }

    .filled { background: green; }

    .tl { top: -8px; left: -8px; }
    .tr { top: -8px; right: -8px; }
    .bl { bottom: -8px; left: -8px; }
    .br { bottom: -8px; right: -8px; }

    /* Popup form */
    #popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 1px solid #ccc;
      padding: 15px;
      background: white;
      display: none;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    #popup input { margin: 5px; }
  </style>
</head>
<body>

<h2>Campus Digital Twin – Bin Registry</h2>

<div class="map">

  <div class="square" data-dept="Computer">
    <div class="corner tl"></div>
    <div class="corner tr"></div>
    <div class="corner bl"></div>
    <div class="corner br"></div>
  </div>

  <div class="square" data-dept="Mechanical">
    <div class="corner tl"></div>
    <div class="corner tr"></div>
    <div class="corner bl"></div>
    <div class="corner br"></div>
  </div>

  <div class="square" data-dept="Civil">
    <div class="corner tl"></div>
    <div class="corner tr"></div>
    <div class="corner bl"></div>
    <div class="corner br"></div>
  </div>

</div>

<!-- Popup Form -->
<div id="popup">
  <h3>Add Bin</h3>
  <input type="text" id="capacity" placeholder="Capacity (120L)" /><br>
  <input type="date" id="date" /><br>
  <input type="file" id="image" /><br><br>
  <button onclick="saveBin()">Save</button>
  <button onclick="closePopup()">Cancel</button>
</div>

<script>
let selectedCorner = null;
let selectedDept = null;

// Open popup when corner clicked
document.querySelectorAll(".corner").forEach(corner => {
  corner.addEventListener("click", (e) => {
    selectedCorner = e.target;
    selectedDept = e.target.closest(".square").dataset.dept;

    document.getElementById("popup").style.display = "block";
  });
});

function closePopup() {
  document.getElementById("popup").style.display = "none";
}

// Save bin to backend
async function saveBin() {
  const capacity = document.getElementById("capacity").value;
  const date = document.getElementById("date").value;
  const imageFile = document.getElementById("image").files[0];

  if (!capacity || !date) {
    alert("Fill all fields");
    return;
  }

  const formData = new FormData();
  formData.append("latitude", Math.random());   // demo coords
  formData.append("longitude", Math.random());
  formData.append("capacity", capacity);
  formData.append("department", selectedDept);
  formData.append("installation_date", date);
  if (imageFile) formData.append("image", imageFile);

  await fetch("http://localhost:5000/bins", {
    method: "POST",
    body: formData
  });

  selectedCorner.classList.add("filled"); // turn green
  closePopup();
}
</script>

</body>
</html>
